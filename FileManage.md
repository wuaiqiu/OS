文件管理

一．文件和文件系统
1.数据项 
(1)基本数据项。这是用于描述一个对象的某种属性的字符集，是数据组织中可以命名的最小逻辑数据单位， 即原子数据，又称为数据元素或字段。
(2)组合数据项。它是由若干个基本数据项组成的，简称组项。

2.记录
记录是一组相关数据项的集合，用于描述一个对象在某方面的属性。
3.文件
文件是指由创建者所定义的、 具有文件名的一组相关元素的集合，可分为有结构文件和无结构文件两种。 在有结构的文件中，文件由若干个相关记录组成；而无结构文件则被看成是一个字符流。文件在文件系统中是一个最大的数据单位，它描述了一个对象集
4.文件系统模型

(1)对象及其属性
     文件管理系统管理的对象有： ① 文件。 它作为文件管理的直接对象。 ② 目录。为了方便用户对文件的存取和检索，在文件系统中必须配置目录。对目录的组织和管理是方便用户和提高对文件存取速度的关键。③ 磁盘(磁带)存储空间。 文件和目录必定占用存储空间，对这部分空间的有效管理，不仅能提高外存的利用率，而且能提高对文件的存取速度。 
(2)对对象操纵和管理的软件集合
     这是文件管理系统的核心部分。文件系统的功能大多是在这一层实现的，其中包括：对文件存储空间的管理、对文件目录的管理、用于将文件的逻辑地址转换为物理地址的机制、对文件读和写的管理，以及对文件的共享与保护等功能。
(3)文件系统的接口
     为方便用户使用文件系统，文件系统通常向用户提供两种类型的接口：命令接口,程序接口。 


二．文件的逻辑结构
1.文件逻辑结构:逻辑结构用来检索每个文件中的每条记录
(1)有结构文件:
即每个文件都有一个以上的记录构成，根据记录的长度可以分：
a.定长记录:指文件中所有的记录长度都是相同的
b.变长记录:指文件中所有的记录长度不相同
根据逻辑结构可分
(1)顺序文件。 (2) 索引文件。 (3) 索引顺序文件。 
(2)无结构文件
   如果说大量的数据结构和数据库，是采用有结构的文件形式的话，则大量的源程序、 可执行文件、 库函数等， 所采用的就是无结构的文件形式，即流式文件。 其长度以字节为单位。对流式文件的访问，则是采用读写指针来指出下一个要访问的字符。

<1>顺序文件
第一种是串结构， 各记录之间的顺序与关键字无关。 
        第二种情况是顺序结构，指文件中的所有记录按关键字(词)排列。
顺序文件的优缺点 
顺序文件的最佳应用场合，是在每次要读或写一大批记录。此时，对顺序文件的存取效率是所有逻辑文件中最高的；此外，也只有顺序文件才能存储在磁带上， 并能有效地工作。	在交互应用的场合，如果用户(程序)要求查找或修改单个记录，为此系统便要去逐个地查找诸记录。 这时， 顺序文件所表现出来的性能就可能很差， 尤其是当文件较大时， 情况更为严重。

<2>索引文件
对于定长记录文件，如果要查找第i个记录， 可直接根据下式计算来获得第i个记录相对于第一个记录首址的地址：
 				 Ai=i×L
       	对于可变长度记录的文件，要查找其第i个记录时，须顺序地查找每个记录，从中获得相应记录的长度Li，然后才能计算出第i个记录的首址。
Ai=L1+L2+..Li

<3>索引顺序文件
它有效克服了变长记录文件不便于直接存取的缺点，它将顺序文件中的所有记录分为若干个组，在为每个组建立一张索引表 


<4>直接文件
对于直接文件，则可根据给定的记录键值，直接获得指定记录的物理地址。这种由记录键值到记录物理地址的转换被称为键值转换(Key to address transformation)。组织直接文件的关键， 在于用什么方法进行从记录值到物理地址的转换。 

<5>哈希(Hash)文件

三.外存分配方式
1.连续分配:要求每一个文件分配一组相邻的盘块

a.连续分配的主要优点如下:(1)顺序访问容易。 (2) 顺序访问速度快。 
b.连续分配的主要缺点如下:(1)要求有连续的存储空间。 (2) 必须事先知道文件的长度。
2.链接分配
(1) 隐式链接
在文件的目录的每个目录项中，都须含有指向链接文件第一个盘块与最后一个盘块的指针，之后，每个盘块都带有一个指向下一个盘块的指针。为了提高检索速度和减小指针所占的存储空间，可以将几个盘块组成一个簇 


(2)显式链接
指把用于链接文件各物理块的指针，显式地存放在内存的一张链接表中（FAT, File Allocation Table 文件分配表）该表在整个磁盘中仅设置一张表的序号是物理块号，指针项为下一个物理块号，以EOF结束，每一个文件的链首指针均存放在每个文件的fcb(file control block,文件控制块)中 ，微软的FAT与NTFS就是采用此技术

链接缺点：
     (1) 不能支持高效的直接存取。要对一个较大的文件进行直接存取，须首先在FAT中顺序地查找许多盘块号。
     (2) FAT需占用较大的内存空间。 

3.索引分配
(1)单级索引分配
它为每一个文件分配一个索引块再把分配给该文件的所有盘块号都记录在该索引块中，在建立一个文件时，只需在其目录项中添加一条指向该索引块的指针，对于大文件存储较好，对于小文件存储则需要浪费较多空间来存储索引块

(2)多级索引分配
在进行大文件存储时，系统分配一个索引块，作为一级索引块，将其他的索引（二级索引）块记录其中，便形成了两级索引分配方式

(3)混合索引方式
将多种索引分配方式相结合形成的一种分配方式 


四.目录管理 

1.目录管理的要求
(1).实现“按名存取”。用户只须向系统提供所需访问文件的名字，便能快速找到指定文件 
(2).提高对目录的检索速度。 
(3).文件共享。 
(4).允许文件重名。 允许不同用户对不同文件采用相同的名字

2.文件控制块 （FCB）
一个FCB就是一个文件目录项，文件目录项的集合叫做文件目录，通常，一个
文件目录也被看做是一个文件，称为目录文件
(1)FCB基本信息类 
① 文件名 ； ② 文件物理位置 ； ③ 文件逻辑结构 ；④ 文件的物理结构 
(2) 存取控制信息类 
(3) 使用信息类 

3.索引结点
(1)将描述文件的信息单独形成一个索引节点，而文件目录项只需要文件名与指向索引节点指针，减小了文件目录的大小，便于检索文件 ，
文件名	索引结点编号
文件1	...
...	...

(2)磁盘索引结点（存放在磁盘上，包含如下信息）
a.文件主标识符 b.文件类型 c.文件存取权限 d.文件物理地址 e.文件长度 
f.文件连接计数 g.文件存取时间

(3)内存索引结点 
a.索引结点编号。 用于标识内存索引结点。
b.状态。 指示i结点是否上锁或被修改。
c.访问计数。 每当有一进程要访问此i结点时， 将该访问计数加1， 访问完再减1。	d.文件所属文件系统的逻辑设备号。

4.目录结构
(1)单级目录结构
在整个文件系统中只建立一张目录表，每个文件占一个目录项，此外，为表明每个目录项是否为空闲，又设置了一个状态位，
文件名	物理地址	文件说明	状态位
文件1			
文件2			
...			
单级目录的优点是简单且能实现目录管理的基本功能——按名存取，但却存在下述一些缺点：
     a.查找速度慢 
     b.不允许重名 
     c.不便于实现文件共享 

(2)两级目录
为每一个用户建立一个单独的用户文件目录（UFD User File Directory）这些文件目录有相似的结构，此外，在系统再建立一个主文件目录MFD(Master File Directory) 在主文件目录中，每个用户目录文件都占一个目录项

具有以下优点：
a.提高了检索目录的速度 
b.在不同的用户目录中， 可以使用相同的文件名。 
c.不同用户还可使用不同的文件名来访问系统中的同一个共享文件 
(3)多级目录结构
多级目录结构又称树形结构，主目录在这里被称为根目录，把数据文件称为
树叶，其它的目录均为树的节点



a.路径名 
     在树形目录结构中， 从根目录到任何数据文件， 都只有一条惟一的通路。 在该路径上从树的根(即主目录)开始， 把全部目录文件名与数据文件名，依次地用“/”连接起来， 即构成该数据文件的路径名(path name)。 系统中的每一个文件都有惟一的路径名。

5.目录查询技术
(1)线性检索法
在单级目录中，利用用户提供的文件名，用顺序查找直接从文件目录中找到指定的目录项,在树形结构中，由于文件名有多个文件分量名组成，此时需要多级目录进行查找
(2)Hash方法


五．文件存储空间的管理

(1)空闲表法
系统为外存的所有空闲区建立一张空闲表，它属于连续分配方式 
序号	第一空闲盘块号	空闲盘块数
1	2	4
2	9	3

(2)空闲链表法 
a.空闲盘块链:这是将磁盘上的所有空闲空间，以盘块为单位拉成一条链
b.空闲盘区链:这是将磁盘上的所有空闲区（包含多个连续的空闲盘块），以
盘区为单位拉成一条链

(3)位示图法
位示图：利用二进制的一位来表示磁盘中一个盘块的使用情况，磁盘上的所有盘块
都有一个二进制位与之对应，这样，由所有盘块所对应的位构成一个集合，称为位示图


(4)成组链接法
利用空闲盘块号栈来存放当前可用的一组盘块号，栈底存放下一个空闲盘块号的指针，用于形成一条链
